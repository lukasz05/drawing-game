(()=>{"use strict";var t,e={869:(t,e,s)=>{var i=s(213);const r="join room",n="user joined room",o="user left room",h="user kicked from room",a="room owner changed",l="start game",c="guess word",d="game started",u="drawing user changed",m="user tried to guess word",g="word to draw",p="started shape",w="pack of coords";function b(t){t.classList.add("is-active")}function x(t){t.classList.remove("is-active")}function f(t){t.classList.remove("is-hidden")}function y(t){t.classList.add("is-hidden")}class S extends Error{constructor(t){super(t),this.name=this.constructor.name}toJSON(){return{name:this.name,message:this.message}}}class v extends S{constructor(t){super(t)}}class k{html;hex;rgb;constructor({html:t,hex:e,rgb:s}){this.html=t,this.hex=e,this.rgb=s}}class C{colors;name;constructor(t=[],e){this.colors=t,this.name=e}getColorByHTMLClass(t){for(let e of this.colors)if(e.html==t)return e;throw new B(`${t} is not in palette ${this.name}`)}getRandomColor(){return this.colors[Math.floor(Math.random()*this.colors.length)]}cloneColorsArray(){return[...this.colors]}}class B extends S{constructor(t){super(t)}}const E=new C([new k({html:"is-red",hex:"#c40233",rgb:{r:196,g:2,b:51}}),new k({html:"is-orange",hex:"#ff7538",rgb:{r:255,g:117,b:56}}),new k({html:"is-orange-light",hex:"#ffa41c",rgb:{r:255,g:164,b:28}}),new k({html:"is-yellow",hex:"#ffd300",rgb:{r:255,g:211,b:0}}),new k({html:"is-green-light",hex:"#80c022",rgb:{r:128,g:192,b:34}}),new k({html:"is-green",hex:"#00ad43",rgb:{r:0,g:173,b:67}}),new k({html:"is-blue-light",hex:"#0075a3",rgb:{r:0,g:117,b:163}}),new k({html:"is-blue",hex:"#22438f",rgb:{r:34,g:67,b:143}}),new k({html:"is-purple",hex:"#69359c",rgb:{r:105,g:53,b:156}})],"main colors"),T=new C([new k({html:"is-white",hex:"#f8f9fa",rgb:{r:248,g:249,b:250}}),new k({html:"is-grey-lightest",hex:"#e9ecef",rgb:{r:233,g:236,b:239}}),new k({html:"is-grey-lighter",hex:"#dee2e6",rgb:{r:222,g:226,b:230}}),new k({html:"is-grey-light",hex:"#ced4da",rgb:{r:206,g:212,b:218}}),new k({html:"is-grey",hex:"#adb5bd",rgb:{r:173,g:181,b:189}}),new k({html:"is-grey-dark",hex:"#6c757d",rgb:{r:108,g:117,b:125}}),new k({html:"is-grey-darker",hex:"#495057",rgb:{r:73,g:80,b:87}}),new k({html:"is-grey-darkest",hex:"#343a40",rgb:{r:52,g:58,b:64}}),new k({html:"is-black",hex:"#212529",rgb:{r:33,g:37,b:41}})],"greyscale colors"),I=T.getColorByHTMLClass("is-white").hex;class L{#t;#e;#s;constructor(t,e,s){this.#t=t,this.#e=e,this.#s=s,this.#i(),this.#r()}#i(){this.#t.on(m,((t,e,s)=>{this.#e.members[t].score+=s?100:-1,this.#r()})),this.#t.on(n,(()=>this.#r())),this.#t.on(o,(()=>this.#r())),this.#t.on(h,(()=>this.#r()))}#r(){const t=document.createElement("table");t.classList.add("table"),Object.values(this.#e.members).sort(((t,e)=>e.score-t.score)).forEach((e=>{const s=this.#n(e);t.appendChild(s)})),this.#s.innerHTML="",this.#s.appendChild(t)}#n(t){const e=document.createElement("tr");e.classList.add("is-uppercase","has-text-weight-bold"),e.style.color=t.color.hex;const s=document.createElement("td");s.classList.add("px-5","py-2"),s.innerText=t.username;const i=document.createElement("td");return i.classList.add("px-5","py-2"),i.innerText=t.score,e.appendChild(s),e.appendChild(i),e}}var G=s(35),z=s.n(G);class D{color;weight;constructor(t,e){this.color=t,this.weight=e}setColor(t){this.color=t}}class O extends D{constructor(){super(T.getColorByHTMLClass("is-grey-darkest"),7)}}class M extends D{constructor(t=E.getColorByHTMLClass("is-yellow")){super(t,20)}}class R extends D{constructor(){super(T.getColorByHTMLClass("is-white"),15)}}class U{constructor(t,e){this.x=t,this.y=e}}class P{constructor(t,e){this.coords=[t],this.tool=e}push(t){return this.coords.push(t)}popBack(){return this.coords.shift()}get length(){return this.coords.length}}class Q{limit;shapes;currentShape;size;constructor(t=null){this.limit=t,this.shapes=[],this.currentShape=null,this.size=0}addShape(t,e){let s=new P(t,e);this.shapes.push(s),this.currentShape=s,this.size+=1,null!=this.limit&&this.size>this.limit&&this.#o()}pushCoord(t){if(null==this.currentShape)throw new v("Tried to push x,y before starting any shape");this.size+=1,null!=this.limit&&this.size>this.limit&&this.#o(),this.currentShape.push(t)}#o(){this.shapes[0].popBack(),0==this.shapes[0].length&&this.shapes.shift(),this.size-=1}clear(){this.size=0,this.currentShape=null,this.shapes=[]}}function j(t,e){return Math.floor(Math.random()*(e-t+1))+t}const N=T.getColorByHTMLClass("is-black").rgb,H=T.getColorByHTMLClass("is-grey-darkest").rgb,_=255;class Y{x;y;dirX;dirY;text;textSize;color;alpha;lifetime;constructor(t,e){this.text=t,this.x=200,this.y=400,this.color=e,this.lifetime=j(100,200),this.dirY=j(-3,-1),this.dirX=j(-1,1),this.alpha=255,this.textSize=50}live(){return 0!=this.lifetime&&(this.lifetime-=1,this.alpha-=4,this.textSize-=.25,this.x+=this.dirX,this.y+=this.dirY,!0)}}class X{x;y;dirX;dirY;text;textSize;color;alpha;lifetime;constructor(t,e,s){this.text=t,this.username=s,this.x=200,this.y=400,this.color=e,this.lifetime=220,this.dirY=-2,this.dirX=0,this.alpha=_,this.textSize=55}live(){return 0!=this.lifetime&&(110==this.lifetime&&(this.text=this.username+"\n guessed!",this.textSize/=2),this.lifetime-=1,this.alpha-=1,this.x+=this.dirX,this.y+=this.dirY,!0)}}class A{x;y;t1;t2;text;textSize;color;alpha;iter;constructor(t,e){this.text=t,this.x=-200,this.y=200,this.transitionLength=800,this.transitionCenter=200,this.t=0,this.color=e,this.alpha=_,this.textSize=70}easeInOutSine(t){return t-=Math.floor(t),-(Math.cos(3.15*t)-1)/2}live(){return!(this.t>2||(this.t<1?this.x=this.easeInOutSine(this.t)*(this.transitionLength/2)-200:this.x=this.transitionCenter+this.easeInOutSine(this.t)*(this.transitionLength/2),this.t+=.015,0))}}class F{x;y;textSize;color;alpha;time;initialValue;constructor(){this.textSize=40,this.x=350,this.y=20,this.alpha=_,this.color=Object.assign({},N),this.time=0,this.initialValue=0}set(t){this.time=t,this.initialValue=t,this.color=Object.assign({},N)}tick(){return!(this.time<=0||(this.color.r=N.r+(255-N.r)*((this.initialValue-this.time)/this.initialValue),this.time-=1,0))}}class J{x;y;text;textSize;color;alpha;constructor(){this.textSize=20,this.x=80,this.y=20,this.color=H,this.alpha=_,this.text=""}displayText(t){this.text=t}}const W=Symbol("STATE_DRAWING"),$=Symbol("STATE_GUESSING"),V=Symbol("STATE_IDLE"),q=Symbol("PENCIL"),K=Symbol("ERASER"),Z=Symbol("HIGHLIGHTER");class tt{mainDrawing;guessInput;gameJustStarted;interval;timer;textQueue;coordQueue;pencilBtn;highlighterBtn;eraserBtn;startGameBtn;pencil;highlighter;eraser;sendGuessBtn;socket;canvas;user;s;constructor(t,e,s,i,r,n,o,h,a,l,c){this.socket=t,this.room=i,this.user=this.room.getMemberData(e),this.gameJustStarted=!1,this.currentState=this.stateGuessing,this.interval=null,this.timer=new F,this.drawMe=new J,this.pencilBtn=n,this.highlighterBtn=o,this.eraserBtn=h,this.guessInput=a,this.sendGuessBtn=l,this.startGameBtn=c,this.pencil=new O,this.eraser=new R,this.highlighter=new M(this.user.color),this.textQueue=[],this.coordQueue=[],this.s=new(z())(this.gameEnvironment.bind(this),r),this.initializeEventListeners(),this.initializeDrawing(s.mainDrawing),this.user.username!=this.room.owner&&(x(this.startGameBtn),y(this.startGameBtn)),x(this.eraserBtn),y(this.eraserBtn),x(this.pencilBtn),y(this.pencilBtn),x(this.highlighterBtn),y(this.highlighterBtn);{const t=document.getElementById(r);t.style.background=this.user.color.hex,t.style.borderStyle="solid",t.style.borderWidth=4,t.style.borderColor=this.user.color.hex}}initializeEventListeners(){this.socket.on(u,((t,e,s)=>this.handleUserChange(t,e,s))),this.socket.on(m,((t,e,s)=>this.handleUserGuess(t,e,s))),this.socket.on(p,((t,e)=>this.handleShapeStart(t,e))),this.socket.on(w,(t=>this.handleCoords(t))),this.socket.on(d,(()=>this.handleGameStart())),this.socket.on(g,(t=>{this.handleNewWord(t)})),this.socket.on(a,(t=>{this.handleOwnerChanged(t)})),this.guessInput.addEventListener("keyup",(t=>{13===t.keyCode&&(t.preventDefault(),this.sendGuess())})),this.sendGuessBtn.addEventListener("click",(()=>this.sendGuess())),this.pencilBtn.addEventListener("click",(()=>this.setTool(q))),this.highlighterBtn.addEventListener("click",(()=>this.setTool(Z))),this.eraserBtn.addEventListener("click",(()=>this.setTool(K))),this.startGameBtn.addEventListener("click",(()=>{this.user.username==this.room.owner&&this.socket.emit(l,(()=>{})),x(this.startGameBtn),y(this.startGameBtn)}))}initializeDrawing(t){if(this.mainDrawing=new Q(1e3),t.size>1e3)throw it(`Drawing has too many points. Max allowed: 1000, drawing.size: ${t.size}`);this.mainDrawing.size=t.size,this.mainDrawing.shapes=t.shapes,this.mainDrawing.currentShape=t.currentShape}setTool(t){switch(t){case q:this.user.currentTool=this.pencil;break;case Z:this.user.currentTool=this.highlighter;break;case K:this.user.currentTool=this.eraser;break;default:throw new st(`Tool unknown: "${t}"`)}}isOnCanvas(t,e){return t<=400&&t>=0&&e<=400&&e>=0}changeState(t){this.currentState.exitState(),this.currentState=t,this.currentState.enterState()}handleGameStart(){this.gameJustStarted=!0}handleOwnerChanged(t){0==this.room.hasGameStarted&&this.user.username==t&&(b(this.startGameBtn),f(this.startGameBtn))}handleUserChange(t,e,s){this.changeState(this.stateIdle);let i="",r=this.stateGuessing;const n=this.room.getUserColor(e).rgb;let o=1==this.gameJustStarted?0:1e3;e==this.user.username?(r=this.stateDrawing,i="YOUR\nTURN!"):(i=e+"'s\n TURN!",this.drawMe.displayText(e+"'s\ndrawing")),setTimeout((()=>{this.textQueue.push(new A(i,n)),this.changeState(r)}),o),this.gameJustStarted=!1;const h=Math.floor((s-Date.now())/1e3);this.interval&&clearInterval(this.interval),this.timer.set(h),this.interval=setInterval((()=>{this.timer.tick()}),1e3)}handleNewWord(t){this.drawMe.displayText("Draw:\n"+t)}handleUserGuess(t,e,s){let i=this.room.getUserColor(t).rgb;s?this.textQueue.push(new X(e,i,t)):this.textQueue.push(new Y(e,i))}handleCoords(t){if(this.currentState.state!=W)for(const e of t)this.mainDrawing.pushCoord(e)}handleShapeStart(t,e){if(this.currentState.state!=W){let s=!0;for(const i of t)s?(this.mainDrawing.addShape(i,e),s=!1):this.mainDrawing.pushCoord(i)}}sendCoordPack(){if(this.currentState.state!=W)throw new et(`User "${this.user.username}" tried to send coordPack but was not in "STATE_DRAWING"!`);this.packetIsFirst?this.socket.emit(p,this.coordQueue,this.user.currentTool,(()=>{})):0!=this.coordQueue.length&&this.socket.emit(w,this.coordQueue,(()=>{})),this.packetIsFirst=!1,this.coordQueue=[]}sendGuess(){if(this.currentState.state!=$)throw new et(`User "${this.user.username}" trying to guess was not in "STATE_GUESSING"!`);this.socket.emit(c,this.guessInput.value,(()=>{}))}gameEnvironment(t){t.drawLine=(e,s,i,r)=>{t.line(e,s,i,r)},t.useTool=e=>{t.stroke(t.color(e.color.hex)),t.strokeWeight(e.weight),t.strokeCap(t.ROUND),t.strokeJoin(t.ROUND)},t.reDraw=()=>{for(const e of this.mainDrawing.shapes){let s=!0,i=null;for(const r of e.coords)s&&(s=!1,i=r),t.useTool(e.tool),t.drawLine(i.x,i.y,r.x,r.y),i=r}},t.drawText=(e,s)=>{const i=e.color;t.fill(t.color(i.r,i.g,i.b,e.alpha)),t.textFont(t.comicFont),t.textSize(e.textSize),t.textAlign(t.CENTER,t.CENTER),t.text(s,e.x,e.y)},t.drawTextObjects=()=>{t.strokeWeight(0);for(let e of this.textQueue)if(e.live())t.drawText(e,e.text);else{const t=this.textQueue.indexOf(e);t>-1&&this.textQueue.splice(t,1)}0!=this.timer.time&&t.drawText(this.timer,this.timer.time+""),t.drawText(this.drawMe,this.drawMe.text)},t.setup=()=>{t.createCanvas(400,400),this.prevCoord=null},t.preload=()=>{t.comicFont=t.loadFont("/fonts/BaksoSapi.otf")},t.mousePressed=()=>{this.currentState.mousePressed()},t.mouseReleased=()=>{this.currentState.mouseReleased()},t.draw=()=>{t.background(t.color(I)),this.currentState.draw(),t.drawTextObjects()}}prevCoord;packetIsFirst;stateDrawing={state:W,enterState:()=>{this.prevCoord=null,this.packetIsFirst=!0,this.mainDrawing.clear(),b(this.eraserBtn),f(this.eraserBtn),b(this.pencilBtn),f(this.pencilBtn),b(this.highlighterBtn),f(this.highlighterBtn)},exitState:()=>{x(this.eraserBtn),y(this.eraserBtn),x(this.pencilBtn),y(this.pencilBtn),x(this.highlighterBtn),y(this.highlighterBtn)},draw:()=>{this.s.reDraw(),null!=this.prevCoord&&this.s.mouseIsPressed&&this.isOnCanvas(this.s.mouseX,this.s.mouseY)&&(this.s.useTool(this.user.currentTool),this.s.drawLine(this.prevCoord.x,this.prevCoord.y,this.s.mouseX,this.s.mouseY),this.prevCoord=new U(this.s.mouseX,this.s.mouseY),this.mainDrawing.pushCoord(this.prevCoord),this.coordQueue.push(this.prevCoord),this.coordQueue.length>=10&&this.sendCoordPack())},mousePressed:()=>{this.isOnCanvas(this.s.mouseX,this.s.mouseY)&&(this.prevCoord=new U(this.s.mouseX,this.s.mouseY),this.mainDrawing.addShape(this.prevCoord,this.user.currentTool),this.coordQueue.push(this.prevCoord),this.packetIsFirst=!0)},mouseReleased:()=>{null!=this.prevCoord&&(this.prevCoord=null,this.sendCoordPack())}};stateGuessing={state:$,enterState:()=>{this.mainDrawing.clear(),b(this.guessInput),this.guessInput.disabled=!1},exitState:()=>{x(this.guessInput),this.guessInput.disabled=!0},draw:()=>{this.s.reDraw()},mousePressed:()=>{},mouseReleased:()=>{}};stateIdle={state:V,enterState:()=>{},exitState:()=>{},draw:()=>{},mousePressed:()=>{},mouseReleased:()=>{}}}class et extends S{constructor(t){super(t)}}class st extends S{constructor(t){super(t)}}class it extends S{constructor(t){super(t)}}function rt(t,e,s){const i=document.getElementById("pencilBtn"),r=document.getElementById("highlighterBtn"),h=document.getElementById("eraserBtn"),l=document.getElementById("guessInput"),c=document.getElementById("sendGuess"),d=document.getElementById("startGame"),u=new class{name;owner;members;hasGameStarted;socket;constructor(t,e){this.name=e.name,this.owner=e.owner,this.members=e.members,this.hasGameStarted=e.hasGameStarted,this.socket=t,this.initializeEventListeners()}initializeEventListeners(){this.socket.on(o,(t=>{delete this.members[t]})),this.socket.on(n,(t=>{this.members[t.username]=t})),this.socket.on(a,(t=>{this.owner=t}))}getMemberData(t){return this.members[t]}getUserColor(t){return this.members[t].color}}(t,s),m=(new tt(t,e,s,u,"game-canvas",i,r,h,l,c,d),document.getElementById("leaderboard-card-content"));new L(t,u,m)}window.addEventListener("load",(function(){const t=document.getElementById("modal-error"),e=document.getElementById("modal-error-content"),s=(0,i.io)("http://localhost:7777"),n=new URLSearchParams(window.location.search),o=n.get("id");if(n.has("username")){const i=n.get("username");s.emit(r,i,o,(r=>{r.success?rt(s,i,r.data):(e.innerText=r.data.message,b(t))}))}else{const t=document.getElementById("modal-set-user-name"),e=document.getElementById("set-user-name-error-notification"),s=document.getElementById("set-user-name");y(e),b(t),this.document.getElementById("set-user-name-form").addEventListener("submit",(t=>{t.preventDefault()})),document.getElementById("send-set-user-name-form").addEventListener("click",(()=>h(s.value,t,e))),s.addEventListener("keydown",(i=>{"Enter"==i.key&&(h(s.value,t,e),i.stopImmediatePropagation())}))}function h(t,e,i){s.emit(r,t,o,(r=>{r.success?(x(e),rt(s,t,r.data)):(i.innerText=r.data.message,f(i))}))}}))}},s={};function i(t){var r=s[t];if(void 0!==r)return r.exports;var n=s[t]={exports:{}};return e[t](n,n.exports,i),n.exports}i.m=e,t=[],i.O=(e,s,r,n)=>{if(!s){var o=1/0;for(c=0;c<t.length;c++){for(var[s,r,n]=t[c],h=!0,a=0;a<s.length;a++)(!1&n||o>=n)&&Object.keys(i.O).every((t=>i.O[t](s[a])))?s.splice(a--,1):(h=!1,n<o&&(o=n));if(h){t.splice(c--,1);var l=r();void 0!==l&&(e=l)}}return e}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[s,r,n]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={757:0,842:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var r,n,[o,h,a]=s,l=0;if(o.some((e=>0!==t[e]))){for(r in h)i.o(h,r)&&(i.m[r]=h[r]);if(a)var c=a(i)}for(e&&e(s);l<o.length;l++)n=o[l],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(c)},s=self.webpackChunksketch_it_client=self.webpackChunksketch_it_client||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var r=i.O(void 0,[35,213,842],(()=>i(869)));r=i.O(r)})();